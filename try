рдареАрдХ рдЖрд╣реЗ Anurag, рддреБрдЭрдВ login рдЭрд╛рд▓рдВ, token рдЯрд╛рдХреВрди authorize рдкрдг рдЭрд╛рд▓рдВ тАФ рддрд░реАрд╕реБрджреНрдзрд╛ /api/calc/premium 403 рджреЗрдд рдЖрд╣реЗ.
ЁЯСЙ рдпрд╛рдЪрд╛ рдПрдХрдЪ reason рдЖрд╣реЗ: рддреБрдЭреНрдпрд╛ SecurityConfig рдордзреНрдпреЗ рд╣рд╛ API protected рдЖрд╣реЗ.


---

тЬЕ ROOT CAUSE тЖТ рддреВ /api/calc/** рд▓рд╛ permitAll рджрд┐рд▓реЗрд▓рдВ рдирд╛рд╣реА

рддреБрдЭреНрдпрд╛ security config рдордзреНрдпреЗ рдлрдХреНрдд рд╣реЗ allowed рдЖрд╣реЗ:

"/swagger-ui/**",
"/v3/api-docs/**",
"/api/auth/**",
"/api/premium/**"

рдкрдг рддреБрдЭрд╛ API рдЖрд╣реЗ:

/api/calc/premium

ЁЯСЙ рдореНрд╣рдгрдЬреЗрдЪ Spring Security рддреНрдпрд╛рд▓рд╛ block рдХрд░рдд рдЖрд╣реЗ тЖТ 403 Forbidden


---

тЬЕ 100% FIX тЖТ SecurityConfig рдордзреНрдпреЗ /api/calc/** allow рдХрд░

рд╣рд╛ рддреБрдЭрд╛ updated SecurityConfig (рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдХрд░реВрди рдЯрд╛рдХрд╛):


---

тнР UPDATED SecurityConfig.java

package com.eapp.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

        http.csrf(csrf -> csrf.disable())
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers(
                                "/swagger-ui/**",
                                "/v3/api-docs/**",
                                "/api/auth/**",
                                "/api/calc/**"     // тЬЕ PREMIUM API NOW ALLOWED
                        ).permitAll()
                        .anyRequest().authenticated()
                );

        return http.build();
    }
}


---

ЁЯЯв рдЕрддрд┐рд╢рдп Important

рддреБрдЭрд╛ premium API path рдЖрд╣реЗ тЖТ /api/calc/premium

SecurityConfig рдордзреНрдпреЗ allow рдХреЗрд▓реЗрд▓реЗ рд╣реЛрддреЗ тЖТ /api/premium/** (wrong)

рдореНрд╣рдгреВрди Spring рдиреЗ block рдХрд░реВрди тЖТ 403 Forbidden рджрд┐рд▓рдВ



---

ЁЯзк рдЖрддрд╛ Swagger рдордзреНрдпреЗ test рдХрд░рдгреНрдпрд╛рдЪреА рдкреНрд░рдХреНрд░рд┐рдпрд╛

1. App рдкреБрдиреНрд╣рд╛ RUN рдХрд░рд╛


2. Swagger рдЙрдШрдбрд╛ тЖТ

http://localhost:8001/swagger-ui/index.html


3. /api/calc/premium рдордзреНрдпреЗ body рдЯрд╛рдХрд╛:

{
  "sumAssured": 500000,
  "policyTerm": 20,
  "age": 30
}


4. Execute рдХрд░рд╛ тЖТ рдЖрддрд╛ response рдпреЗрдИрд▓.




---

тЭдя╕П Want me to check your complete backend?

рддреБрд▓рд╛ рдкрд╛рд╣рд┐рдЬреЗ рдЕрд╕реЗрд▓ рддрд░ рддреВ controller + service + dto рдЪрд╛ screenshot рдкрд╛рдард╡,
рдореА рдкреВрд░реНрдг verify рдХрд░реВрди рджреЗрддреЛ.
